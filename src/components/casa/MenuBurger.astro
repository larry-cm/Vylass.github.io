---
import BtnPerfil from "@components/casa/BtnPerfil.astro";
import Image from "astro/components/Image.astro";
const location = Astro.url.pathname;
interface Props {
    userSession: string;
    userName: string;
    userImg: string;
    entrada: {
        text: string;
        url: string;
    }[];
}

const { userSession, userName, userImg, entrada } = Astro.props;
---

<input type="checkbox" id="btn-burger" class="peer hidden" />
<label class="cursor-pointer peer-checked:*:*:-rotate-180" for="btn-burger">
    <span class="sr-only">Menu de hamburguesa para los celulares</span>
    <span class="md:hidden">
        <svg
            class="transition-transform duration-300"
            width="30"
            height="30"
            viewBox="0 0 24 24"
            fill="currentColor"
        >
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path
                d="M18 3a3 3 0 0 1 2.995 2.824l.005 .176v12a3 3 0 0 1 -2.824 2.995l-.176 .005h-12a3 3 0 0 1 -2.995 -2.824l-.005 -.176v-12a3 3 0 0 1 2.824 -2.995l.176 -.005h12zm0 2h-12a1 1 0 0 0 -.993 .883l-.007 .117v9h14v-9a1 1 0 0 0 -.883 -.993l-.117 -.007zm-7.387 3.21l.094 .083l1.293 1.292l1.293 -1.292a1 1 0 0 1 1.32 -.083l.094 .083a1 1 0 0 1 .083 1.32l-.083 .094l-2 2a1 1 0 0 1 -1.32 .083l-.094 -.083l-2 -2a1 1 0 0 1 1.32 -1.497z"
            ></path>
        </svg>
    </span>
</label>

<menu
    class={`fixed z-40 top-[10vh] left-0 right-0 w-full mx-auto max-w-full transition-all duration-300 ease-in-out
        bg-orange-500 rounded-b
        opacity-0 -translate-y-[10vh] scale-y-95 pointer-events-none
        peer-checked:opacity-100 peer-checked:scale-y-100 peer-checked:pointer-events-auto peer-checked:translate-y-0
        flex flex-wrap items-center gap-4 p-4
        ${userSession === "true" ? "justify-between" : "justify-start"}
        md:hidden
    `}
>
    <!-- <label for="btn-burger" class="absolute right-4 top-4 text-5xl"
        >&times;</label
    > -->
    {
        userSession === "true" ? (
            <>
                <BtnPerfil userName={userName}>
                    <div slot="before">
                        <Image
                            loading="eager"
                            height="32"
                            width="32"
                            class="rounded-full"
                            src={userImg}
                            title="imagen de perfil del usuario del menu hamburguesa"
                            alt="imagen de perfil del usuario del menu hamburguesa"
                        />
                    </div>
                </BtnPerfil>
                <li class="group bg-black px-3 py-2 rounded flex items-center cursor-pointer cerrar-session transition-all">
                    <button
                        class="flex items-center gap-1 text-white group-hover:text-red-500 font-medium relative transition-colors focus:outline-none"
                        style="outline: none;"
                        aria-label="Cerrar sesión"
                    >
                        <svg
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.7"
                            stroke="currentColor"
                            class="w-5 h-5 transition-transform group-hover:-translate-x-0.5 group-hover:text-red-500"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"
                            />
                        </svg>
                        <span slot="before" class="relative transition-colors">
                            Cerrar sesión
                        </span>
                    </button>
                </li>
            </>
        ) : (
            entrada?.map(({ url, text }) => (
                <li
                    class:list={[
                        "border border-slate-200 rounded px-3 py-2 focus:outline-none focus:ring transition-all",

                        {
                            "bg-white dark:bg-[#1a1a1a] text-orange-600 dark:text-orange-400 hover:shadow-md  focus:ring-orange-300 dark:focus:ring-orange-500":
                                url === "/",
                        },
                        {
                            "bg-white/20 text-white backdrop-blur-sm hover:bg-white/30 focus:ring-white/50":
                                url !== "/",
                        },
                    ]}
                >
                    <a
                        href={url === "/" && location === "/" ? "#main" : url}
                        class="block w-full h-full font-medium text-center"
                    >
                        {text}
                    </a>
                </li>
            ))
        )
    }
</menu>
<script is:inline>
    function getElements() {
        return {
            burger: document.getElementById("btn-burger"),
            menu: document.querySelector("menu"),
            m: document.getElementById("main"),
            label: document.querySelector('label[for="btn-burger"]'),
        };
    }

    document?.addEventListener("click", (event) => {
        const { burger, menu, label, m } = getElements();

        if (
            burger &&
            burger.checked &&
            menu &&
            !menu.contains(event.target) &&
            event.target !== burger &&
            !(label && label.contains(event.target))
        )
            burger.checked = false;
    });
</script>
